<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des documents YAML</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 2rem;
        }
        .container {
            max-width: 800px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Gestion des documents YAML</h1>
        <hr>

        <!-- Alert Messages -->
        <div id="alert-container"></div>

        <!-- Formulaire pour créer un document YAML -->
        <div class="mb-4">
            <h2>Créer un document YAML</h2>
            <form id="create-form">
                <div class="form-group">
                    <label for="create-yaml">Contenu du document YAML</label>
                    <textarea class="form-control" id="create-yaml" rows="5" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Créer</button>
            </form>
        </div>

        <!-- Formulaire pour lire un document YAML -->
        <div class="mb-4">
            <h2>Lire un document YAML</h2>
            <form id="read-form" class="form-inline">
                <div class="form-group mb-2">
                    <label for="read-id" class="sr-only">ID du document YAML</label>
                    <input type="text" class="form-control" id="read-id" placeholder="ID du document YAML" required>
                </div>
                <button type="submit" class="btn btn-primary mb-2 ml-2">Lire</button>
            </form>
            <pre id="read-output" class="mt-3"></pre>
        </div>

        <!-- Formulaire pour mettre à jour un document YAML -->
        <div class="mb-4">
            <h2>Mettre à jour un document YAML</h2>
            <form id="update-form">
                <div class="form-group">
                    <label for="update-id">ID du document YAML</label>
                    <input type="text" class="form-control" id="update-id" placeholder="ID du document YAML" required>
                </div>
                <div class="form-group">
                    <label for="update-yaml">Nouveau contenu du document YAML</label>
                    <textarea class="form-control" id="update-yaml" rows="5" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Mettre à jour</button>
            </form>
        </div>

        <!-- Formulaire pour supprimer un document YAML -->
        <div class="mb-4">
            <h2>Supprimer un document YAML</h2>
            <form id="delete-form" class="form-inline">
                <div class="form-group mb-2">
                    <label for="delete-id" class="sr-only">ID du document YAML</label>
                    <input type="text" class="form-control" id="delete-id" placeholder="ID du document YAML" required>
                </div>
                <button type="submit" class="btn btn-danger mb-2 ml-2">Supprimer</button>
            </form>
        </div>

        <!-- Liste des documents YAML -->
        <div>
            <h2>Liste des documents YAML</h2>
            <button class="btn btn-info mb-3" id="list-yamls">Charger la liste des documents</button>
            <ul class="list-group" id="yaml-list"></ul>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script>
        const apiUrl = "https://fastapiapp-e88c18fc1835.herokuapp.com/api/yaml";

        function showAlert(message, type="success") {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.role = "alert";
            alert.innerHTML = `
                ${message}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            `;
            alertContainer.appendChild(alert);

            // Automatically close the alert after 5 seconds
            setTimeout(() => {
                $(alert).alert('close');
            }, 5000);
        }

        document.getElementById('create-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const yamlContent = document.getElementById('create-yaml').value;
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-yaml'},
                    body: yamlContent
                });
                const result = await response.json();
                if (response.ok) {
                    showAlert('Document créé avec succès', 'success');
                    document.getElementById('create-yaml').value = '';
                } else {
                    showAlert(`Erreur: ${result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('Une erreur est survenue lors de la création du document YAML.', 'danger');
            }
        });

        document.getElementById('read-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const yamlId = document.getElementById('read-id').value;
            try {
                const response = await fetch(`${apiUrl}/${yamlId}`);
                const result = await response.json();
                if (response.ok) {
                    document.getElementById('read-output').textContent = JSON.stringify(result, null, 2);
                } else {
                    showAlert(`Erreur: ${result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('Une erreur est survenue lors de la lecture du document YAML.', 'danger');
            }
        });

        document.getElementById('update-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const yamlId = document.getElementById('update-id').value;
            const yamlContent = document.getElementById('update-yaml').value;
            try {
                const response = await fetch(`${apiUrl}/${yamlId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/x-yaml'},
                    body: yamlContent
                });
                const result = await response.json();
                if (response.ok) {
                    showAlert('Document mis à jour avec succès', 'success');
                    
                } else {
                    showAlert(`Erreur: ${result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('Une erreur est survenue lors de la mise à jour du document YAML.', 'danger');
            }
        });

        document.getElementById('delete-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const yamlId = document.getElementById('delete-id').value;
            try {
                const response = await fetch(`${apiUrl}/${yamlId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    showAlert('Document supprimé avec succès', 'success');
                } else {
                    const result = await response.json();
                    showAlert(`Erreur: ${result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('Une erreur est survenue lors de la suppression du document YAML.', 'danger');
            }
        });

        document.getElementById('list-yamls').addEventListener('click', async () => {
            try {
                const response = await fetch(apiUrl);
                const result = await response.json();
                if (response.ok) {
                    const yamlList = document.getElementById('yaml-list');
                    yamlList.innerHTML = '';
                    result.data.forEach(doc => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `ID: ${doc.id}, Contenu: ${JSON.stringify(doc)}`;
                        listItem.classList.add('list-group-item');
                        yamlList.appendChild(listItem);
                    });
                } else {
                    showAlert(`Erreur: ${result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('Une erreur est survenue lors du chargement de la liste des documents YAML.', 'danger');
            }
        });
    </script>
</body>
</html>
